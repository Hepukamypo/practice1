# –ü–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á—ë—Ç –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é Telegram-–±–æ—Ç–∞ –Ω–∞ Python —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `aiogram`

## 1. –¶–µ–ª—å –∏ –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á

–¶–µ–ª—å: —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å Telegram-–±–æ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π  –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —É—á–∏—Ç—å –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ —Å–ª–æ–≤–∞, –¥–æ–±–∞–≤–ª—è—è –Ω–æ–≤—ã–µ —Å–ª–æ–≤–∞ –≤ –∏—Ö –ª–∏—á–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏ –ø–æ–≤—Ç–æ—Ä—è—è –∏—Ö –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é

**–û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ö–æ–º–∞–Ω–¥–∞ `/start` ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è.
- –ö–æ–º–∞–Ω–¥–∞ `/add` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–æ.
- –ö–æ–º–∞–Ω–¥–∞ `/learn` ‚Äî –≤—ã—É—á–∏—Ç—å —Å–ª–æ–≤–∞.
- –ö–æ–º–∞–Ω–¥–∞ `/repeat` ‚Äî –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ —Å–ª–æ–≤.
- –ö–æ–º–∞–Ω–¥–∞ `/stats` ‚Äî –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.
- –ö–æ–º–∞–Ω–¥–∞ `/test` ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ–±—è.


---

## 2. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### 2.1 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Python 3.10+
- –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:

```bash
python -m venv venv
source venv/bin/activate  # Linux/macOS
venv\Scripts\activate  # Windows
```

- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
pip install aiogram pymongo python-dotenv
```

### 2.2 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `.env`

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:

```
BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞
```

---
## 3. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –±–æ—Ç–∞ –≤ Telegram —á–µ—Ä–µ–∑ BotFather
1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram –∏ –Ω–∞–π–¥–∏—Ç–µ **@BotFather**.
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newbot`.
3. –ü—Ä–∏–¥—É–º–∞–π—Ç–µ –∏–º—è –∏ username.
4. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ `.env`.
## 4. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
bot_project/
‚îÇ
‚îú‚îÄ‚îÄ main.py              # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±–æ—Ç–∞
‚îú‚îÄ‚îÄ words.db                # –†–∞–±–æ—Ç–∞ —Å MongoDB
‚îú‚îÄ‚îÄ .env
‚îî‚îÄ‚îÄ requirements.txt     # –°–ø–∏—Å–æ–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```

---

## 5. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏
### 5.1 –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥

### 5.2. –ö–æ–º–∞–Ω–¥–∞ `/start`
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã.
```py
@dp.message_handler(commands=['start'])
async def start(message: types.Message):
    await message.answer("–ü—Ä–∏–≤–µ—Ç! –Ø –ø–æ–º–æ–≥—É —Ç–µ–±–µ —É—á–∏—Ç—å –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ —Å–ª–æ–≤–∞.\n\n–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\n/add ‚Äî –¥–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–æ\n/learn ‚Äî –ø–æ–ª—É—á–∏—Ç—å 5 –Ω–æ–≤—ã—Ö —Å–ª–æ–≤\n/repeat
});
```
### 5.3. –ö–æ–º–∞–Ω–¥–∞ `/add`
–ü–µ—Ä–≤—ã–π —à–∞–≥: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –∞–Ω–≥–ª–∏–π—Å–∫–æ–µ —Å–ª–æ–≤–æ.
```py
@dp.message_handler(commands=['add'])
async def cmd_add(message: types.Message):
    await message.answer("–í–≤–µ–¥–∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–µ —Å–ª–æ–≤–æ:")
    await AddWord.English.set()
```
 –í—Ç–æ—Ä–æ–π —à–∞–≥: –ø–µ—Ä–µ–≤–æ–¥.
```py
@dp.message_handler(state=AddWord.English)
async def process_en(message: types.Message, state: FSMContext):
    await state.update_data(en=message.text.strip())
    await message.answer("–¢–µ–ø–µ—Ä—å –≤–≤–µ–¥–∏ –ø–µ—Ä–µ–≤–æ–¥:")
    await AddWord.Russian.set()
```
–¢—Ä–µ—Ç–∏–π —à–∞–≥: –ø—Ä–∏–º–µ—Ä.
```py
@dp.message_handler(state=AddWord.English)
async def process_en(message: types.Message, state: FSMContext):
    await state.update_data(en=message.text.strip())
    await message.answer("–¢–µ–ø–µ—Ä—å –≤–≤–µ–¥–∏ –ø–µ—Ä–µ–≤–æ–¥:")
    await AddWord.Russian.set()
```
–î–æ–±–∞–≤–ª—è–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü—É words. –ó–∞–≤–µ—Ä—à–∞–µ—Ç –¥–∏–∞–ª–æ–≥.
```py
@dp.message_handler(state=AddWord.Example)
async def process_example(message: types.Message, state: FSMContext):
    data = await state.get_data()
    en, ru, ex = data['en'], data['ru'], message.text.strip()
    cursor.execute("INSERT OR IGNORE INTO words (en, ru, example) VALUES (?, ?, ?)", (en, ru, ex))
    conn.commit()
    await message.answer(f"–°–ª–æ–≤–æ '{en}' –¥–æ–±–∞–≤–ª–µ–Ω–æ!")
    await state.finish()

```
### 5.4. –ö–æ–º–∞–Ω–¥–∞ `/learn`
–°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
```py
@dp.message_handler(commands=['learn'])
async def learn_words(message: types.Message):
    user_id = message.from_user.id
```
–ü–æ–ª—É—á–∞–µ–º —Å–ª–æ–≤–∞, –∫–æ—Ç–æ—Ä—ã—Ö –µ—â—ë –Ω–µ—Ç —É —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ user_words.
```py
    cursor.execute("SELECT en FROM words WHERE en NOT IN (SELECT word_en FROM user_words WHERE user_id = ?)", (user_id,))
    new_words = cursor.fetchall()
```
–ï—Å–ª–∏ –Ω–µ—Ç –Ω–æ–≤—ã—Ö —Å–ª–æ–≤ ‚Äî —Å–æ–æ–±—â–∞–µ–º –æ–± —ç—Ç–æ–º.
```py
    if not new_words:
        await message.answer("–ù–µ—Ç –Ω–æ–≤—ã—Ö —Å–ª–æ–≤ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è. –î–æ–±–∞–≤—å –∏—Ö —á–µ—Ä–µ–∑ /add.")
        return
```
–ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª–æ–≤–æ, –ø–µ—Ä–µ–≤–æ–¥ –∏ –ø—Ä–∏–º–µ—Ä.
```py
    to_learn = new_words[:5]
    for word in to_learn:
        en = word[0]
        cursor.execute("SELECT ru, example FROM words WHERE en = ?", (en,))
        ru, ex = cursor.fetchone()
        await message.answer(f"{en} ‚Äî {ru}\n–ü—Ä–∏–º–µ—Ä: {ex}")
```
–î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–≤–æ –≤ user_words, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—è:
repeat_stage = 0
last_repeat = —Å–µ–≥–æ–¥–Ω—è
```py
        cursor.execute("INSERT INTO user_words (user_id, word_en, last_repeat, repeat_stage) VALUES (?, ?, ?, ?)",
                       (user_id, en, datetime.now().date(), 0))
    conn.commit()

```
### 5.5. –ö–æ–º–∞–Ω–¥–∞ `/stats`
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–≤ –∏ –≤—ã—É—á–µ–Ω–Ω—ã–µ.
```py
@dp.message_handler(commands=['stats'])
async def stats(message: types.Message):
    user_id = message.from_user.id
    cursor.execute("SELECT COUNT(*) FROM user_words WHERE user_id = ?", (user_id,))
    total = cursor.fetchone()[0]
    cursor.execute("SELECT COUNT(*) FROM user_words WHERE user_id = ? AND learned = 1", (user_id,))
    learned = cursor.fetchone()[0]
    await message.answer(f"–í—Å–µ–≥–æ —Å–ª–æ–≤: {total}\n–í—ã—É—á–µ–Ω–æ: {learned}")
```
### 5.6. –ö–æ–º–∞–Ω–¥–∞ `/test`
–ò—â–µ–º —Å–ª–æ–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—â—ë –Ω–µ –≤—ã—É—á–∏–ª.
```py
@dp.message_handler(commands=["test"])
async def cmd_test(message: types.Message, state: FSMContext):
```
–ë–µ—Ä—ë–º —Å–ª—É—á–∞–π–Ω–æ–µ:
```py
    cursor.execute("""
        SELECT w.en, w.ru FROM words w
        JOIN user_words uw ON w.en = uw.word_en
        WHERE uw.user_id = ? AND uw.learned = 0
    """, (user_id,))
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –æ—Ç–≤–µ—Ç
```py
    word = random.choice(words)
    await state.update_data(current_word_en=word[0], current_word_ru=word[1])
    await message.answer(f"üëâ –ü–µ—Ä–µ–≤–µ–¥–∏: <b>{word[0]}</b>", parse_mode=ParseMode.HTML)
    await TestWord.waiting_for_translation.set()

```
–°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –æ—Ç–≤–µ—Ç:
```py
    if user_input == correct:
        await message.answer("‚úÖ –í–µ—Ä–Ω–æ!")
        cursor.execute("""
            UPDATE user_words SET repeat_stage = repeat_stage + 1, last_repeat = CURRENT_DATE
            WHERE user_id = ? AND word_en = ?
        """, ...)
```
–ï—Å–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:
```py
        await message.answer(f"‚ùå –ù–µ–≤–µ—Ä–Ω–æ. –ü—Ä–∞–≤–∏–ª—å–Ω–æ: <b>{correct}</b>", parse_mode=ParseMode.HTML)
```
–î–∞–ª–µ–µ ‚Äî –Ω–æ–≤–æ–µ —Å–ª–æ–≤–æ, –ª–∏–±–æ –∑–∞–≤–µ—Ä—à–∞–µ–º:
```py
    if user_input == correct:
        await message.answer("‚úÖ –í–µ—Ä–Ω–æ!")
        cursor.execute("""
            UPDATE user_words SET repeat_stage = repeat_stage + 1, last_repeat = CURRENT_DATE
            WHERE user_id = ? AND word_en = ?
        """, ...)
```
### 5.5. –ö–æ–º–∞–Ω–¥–∞ `/stop`
–ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞
```py
@dp.message_handler(commands=["stop"], state=TestWord.waiting_for_translation)
async def cmd_stop(message: types.Message, state: FSMContext):
    await state.finish()
    await message.answer("üõë –¢–µ—Å—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –í–æ–∑–≤—Ä–∞—â–∞–π—Å—è, –∫–æ–≥–¥–∞ –±—É–¥–µ—à—å –≥–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å!")
```
### 5.5. –ö–æ–º–∞–Ω–¥–∞ `/stop`
–í–Ω–∏–∑—É –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è:
```py
intervals = [0, 1, 3, 7, 14]

def get_words_for_repeat(user_id):
```
```py
@dp.message_handler(commands=["repeat"])
async def repeat_handler(message: types.Message, state: FSMContext):
```
–ï—Å–ª–∏ –µ—Å—Ç—å —Å–ª–æ–≤–∞ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è:
```py
    await state.update_data(words_to_repeat=words_to_repeat, current_index=0)
```
–°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤ –∏ —Ç–µ–∫—É—â–∏–π –∏–Ω–¥–µ–∫—Å.
```py
    en, ru = words_to_repeat[0]
    cursor.execute("SELECT example FROM words WHERE en = ?", (en,))
    (ex,) = cursor.fetchone()
```
 –ë–µ—Ä—ë–º –ø–µ—Ä–≤–æ–µ —Å–ª–æ–≤–æ –∏ –ø—Ä–∏–º–µ—Ä.
```py
    keyboard = InlineKeyboardMarkup(row_width=2)
    keyboard.insert(InlineKeyboardButton("–ó–Ω–∞—é", callback_data=repeat_cb.new(word=en, action="know")))
    keyboard.insert(InlineKeyboardButton("–ù–µ –∑–Ω–∞—é", callback_data=repeat_cb.new(word=en, action="dont_know")))
```
 –°–æ–∑–¥–∞—ë–º inline-–∫–Ω–æ–ø–∫–∏.
```py
    await message.answer(f"–ü–æ–≤—Ç–æ—Ä–∏ —Å–ª–æ–≤–æ:\n\n{en} ‚Äî {ru}\n–ü—Ä–∏–º–µ—Ä: {ex}", reply_markup=keyboard)
```

Callback ‚Äî "–ó–Ω–∞—é / –ù–µ –∑–Ω–∞—é"
```py
@dp.callback_query_handler(repeat_cb.filter())
async def repeat_callback_handler(query: types.CallbackQuery, callback_data: dict, state: FSMContext):
```
–ü–æ–ª—É—á–∞–µ–º –≤—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```py
    action = callback_data["action"]
```
–ï—Å–ª–∏ –ó–Ω–∞—é:
–ü–æ–≤—ã—à–∞–µ–º repeat_stage + –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞—Ç—É.
```py
    if action == "know":
        cursor.execute("""
            UPDATE user_words
            SET repeat_stage = MIN(repeat_stage + 1, ?), last_repeat = ?
            WHERE user_id = ? AND word_en = ?
        """, (MAX_STAGE, datetime.now().date(), user_id, word))
```
–ï—Å–ª–∏ –ù–µ –∑–Ω–∞—é:–û–±–Ω—É–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ
```py
    else:
        cursor.execute("""
            UPDATE user_words
            SET repeat_stage = 0, last_repeat = ?
            WHERE user_id = ? AND word_en = ?
        """, (datetime.now().date(), user_id, word))
```
–î–∞–ª–µ–µ ‚Äî –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Å–ª–æ–≤—É:
```py
    data = await state.get_data()
    words = data.get("words_to_repeat", [])
    index = data.get("current_index", 0) + 1
```
–ï—Å–ª–∏ –µ—Å—Ç—å –µ—â—ë —Å–ª–æ–≤–∞ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª–µ–¥—É—é—â–µ–µ.
–ï—Å–ª–∏ –≤—Å—ë –ø–æ–≤—Ç–æ—Ä–µ–Ω–æ:
```py
    await state.finish()
    await query.message.edit_text("üéâ –í—Å–µ —Å–ª–æ–≤–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω—ã! –ú–æ–ª–æ–¥–µ—Ü!")
```
## 5. –ü—Ä–∏–º–µ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

```plaintext
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /start
–ë–æ—Ç: –ü—Ä–∏–≤–µ—Ç! –Ø –ø–æ–º–æ–≥—É –≤–∞–º –æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É...

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /new
–ë–æ—Ç: –í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –§–ò–û

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω
–ë–æ—Ç: –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: +79998887766
–ë–æ—Ç: –û–ø–∏—à–∏—Ç–µ –≤–∞—à—É –ø—Ä–æ–±–ª–µ–º—É

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
–ë–æ—Ç: –ó–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞!

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /history
–ë–æ—Ç: 
1. –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω, +79998887766, –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç (2025-05-22 10:30:00)
```

---

## 6. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```py
if __name__ == '__main__':
    executor.start_polling(dp, skip_updates=True)

```



---

## 7. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

- –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–Ω–æ–ø–æ–∫ —Å `InlineKeyboardMarkup`.
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è/–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞.
- –≠–∫—Å–ø–æ—Ä—Ç –∑–∞—è–≤–æ–∫ –≤ Excel –∏–ª–∏ PDF.

